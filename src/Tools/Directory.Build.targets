<Project>
  <Import Project="$(MSBuildThisFileDirectory)..\Directory.Build.targets"/>

  <Target Name="_GetPackageVersionInfo" DependsOnTargets="$(GetPackageVersionDependsOn)"
          Returns="@(_ProjectPathWithVersion)">
    <ItemGroup>
      <_ProjectPathWithVersion Include="$(MSBuildProjectFullPath)">
        <PackageVersion>$(Version)</PackageVersion>
      </_ProjectPathWithVersion>
    </ItemGroup>
  </Target>

  <Target Name="CollectBundleFilesToSign"
          DependsOnTargets="ComputeFilesToPublish"
          AfterTargets="ComputeFilesToPublish"
          Returns="@(FilesInBundleToSign)">
    <ItemGroup>
      <FilesInBundleToSign Include="@(_FilesToBundle)" Condition="'%(_FilesToBundle.FileName)%(_FilesToBundle.Extension)' != '$(PublishedSingleFileName)'"/>
    </ItemGroup>
  
    <Message Importance="Low" Text="@(FilesInBundleToSign)"/>
  </Target>

  <Target Name="PrepareForBundling"
          BeforeTargets="GenerateSingleFileBundle"
          AfterTargets="_ComputeFilesToBundle"
          DependsOnTargets="RemoveDupeAssemblies" />

  <!-- Workaround for https://github.com/microsoft/perfview/issues/1002 -->
  <Target Name="RemoveDupeAssemblies">
    <ItemGroup>
      <_FilesToBundle Remove="$(PkgMicrosoft_Diagnostics_Tracing_TraceEvent)\lib\netstandard1.6\Dia2Lib.dll" />
      <_FilesToBundle Remove="$(PkgMicrosoft_Diagnostics_Tracing_TraceEvent)\lib\netstandard1.6\OSExtensions.dll" />
      <_FilesToBundle Remove="$(PkgMicrosoft_Diagnostics_Tracing_TraceEvent)\lib\netstandard1.6\TraceReloggerLib.dll" />
    </ItemGroup>
  </Target>
</Project>