<Project>
  <Import Project="$(MSBuildThisFileDirectory)..\Directory.Build.targets"/>

  <!--
    Shared target to copy debuggee sources and aux MSBuild files to artifacts for Helix testing.
    Projects opt-in by setting CopyDebuggeeSourcesToArtifacts=true.
    Optional: Set CopyLldbPluginTests=true to also copy lldbplugin.tests.
  -->
  <Target Name="CopyDebuggeeSources" AfterTargets="Build" Condition="'$(CopyDebuggeeSourcesToArtifacts)' == 'true'">
    <PropertyGroup>
      <DebuggeesDestDir>$(ArtifactsDir)test/DebuggeeSources/$(MSBuildProjectName)/Debuggees</DebuggeesDestDir>
      <AuxMsbuildDestDir>$(ArtifactsDir)test/AuxMsbuildFiles</AuxMsbuildDestDir>
      <LldbPluginTestsDestDir>$(ArtifactsDir)test/lldbplugin.tests</LldbPluginTestsDestDir>
    </PropertyGroup>
    <ItemGroup>
      <DebuggeeSourceFiles Include="$(MSBuildProjectDirectory)/Debuggees/**/*" />
      <AuxMsbuildFiles Include="$(RepoRoot)eng/AuxMsbuildFiles/**/*" />
      <LldbPluginTestFiles Include="$(TestDir)lldbplugin.tests/**/*" Condition="'$(CopyLldbPluginTests)' == 'true'" />
    </ItemGroup>
    <Copy SourceFiles="@(DebuggeeSourceFiles)"
      DestinationFolder="$(DebuggeesDestDir)/%(RecursiveDir)"
      SkipUnchangedFiles="true" />
    <Copy SourceFiles="@(AuxMsbuildFiles)"
      DestinationFolder="$(AuxMsbuildDestDir)/%(RecursiveDir)"
      SkipUnchangedFiles="true" />
    <Copy SourceFiles="@(LldbPluginTestFiles)"
      DestinationFolder="$(LldbPluginTestsDestDir)/%(RecursiveDir)"
      SkipUnchangedFiles="true"
      Condition="'$(CopyLldbPluginTests)' == 'true'" />
    <Message Importance="High" Text="Copied debuggee sources to $(DebuggeesDestDir)" />
    <Message Importance="High" Text="Copied aux MSBuild files to $(AuxMsbuildDestDir)" />
    <Message Importance="High" Text="Copied lldbplugin.tests to $(LldbPluginTestsDestDir)" Condition="'$(CopyLldbPluginTests)' == 'true'" />
  </Target>

</Project>
